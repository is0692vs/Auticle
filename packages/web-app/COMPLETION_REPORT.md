# Audicle Web App 開発完了レポート

## やったことのまとめ

Next.js (React) + TypeScript を使用して、音楽アプリの歌詞表示のような体験を提供する Web アプリケーションを新規開発しました。

### 実装した機能

#### 1. プロジェクトの初期設定 (コミット 1)

- **技術スタック**: Next.js 15, React 19, TypeScript, Tailwind CSS
- **ディレクトリ構成**: `packages/web-app/` 配下にプロジェクトを作成
- **型定義**: API 連携用の型定義 (`types/api.ts`) を追加
- **環境変数**: `.env.local` で API サーバーの URL を設定可能に

#### 2. 基本的な UI レイアウトの実装 (コミット 2)

- **ヘッダー部分**:
  - アプリケーション名「Audicle」を表示
  - URL 入力フォーム (記事 URL の入力欄と「読込」ボタン)
  - 記事タイトルの表示エリア
- **リーダービュー** (`components/ReaderView.tsx`):
  - 本文の段落を表示する専用エリア
  - クリーン&シンプルなデザイン
  - ダークモード対応

#### 3. /extract API と連携した本文表示機能 (コミット 3)

- **API クライアント** (`lib/api.ts`):
  - `extractContent()`: URL から本文を抽出
  - `synthesizeSpeech()`: テキストを音声化
- **本文の表示**:
  - 抽出されたテキストを段落 (チャンク) 単位で表示
  - 各チャンクに一意の ID (`chunk-0`, `chunk-1`, ...) を付与
  - エラーハンドリングとローディング状態の表示

#### 4. /synthesize API と連携した単一チャンクの再生機能 (コミット 4)

- **再生制御フック** (`hooks/usePlayback.ts`):
  - クライアントサイド・オーケストレーション
  - 再生キューの管理
  - 音声合成リクエストの管理
- **再生コントロール**:
  - 再生/一時停止ボタン
  - 停止ボタン
  - 処理中の状態表示

#### 5. 連続再生、自動スクロール同期ハイライト、クリック再生機能 (コミット 5)

- **連続再生**:
  - `<audio>` の `onended` イベントで次のチャンクを自動再生
  - 再生キューを順次処理
- **自動スクロール**:
  - 再生中のチャンクが常に画面中央付近に表示されるよう自動スクロール
  - スムーズなスクロールアニメーション
- **ハイライト表示**:
  - 再生中のチャンクを黄色背景でハイライト
  - `scale-105` で視覚的に強調
- **クリック再生 (Seek 機能)**:
  - リーダービュー内の任意の段落をクリック
  - その位置から再生を開始
  - `seekToChunk()` 関数で実装

### アーキテクチャのポイント

1. **クライアントサイド・オーケストレーション**:

   - すべての再生ロジックはフロントエンド側で実装
   - バックエンドはシンプルな API 提供のみ

2. **カスタムフック (`usePlayback`)**:

   - 再生ロジックを再利用可能な形で実装
   - State 管理と副作用を分離

3. **レスポンシブデザイン**:

   - モバイルからデスクトップまで対応
   - Tailwind CSS による効率的なスタイリング

4. **型安全性**:
   - TypeScript による完全な型定義
   - API レスポンスの型安全な処理

## 実行方法

### 前提条件

1. **Node.js 18 以上**がインストールされていること
2. **api-server が起動していること** (http://localhost:8000)

### 手順

```bash
# 1. プロジェクトディレクトリに移動
cd /workspaces/Auticle/packages/web-app

# 2. 依存関係をインストール (初回のみ)
npm install

# 3. 開発サーバーを起動
npm run dev
```

### アクセス

ブラウザで [http://localhost:3000](http://localhost:3000) を開きます。

### 本番ビルド

```bash
# ビルド
npm run build

# 本番サーバー起動
npm start
```

## テスト方法

### 基本的な動作確認

1. **URL の読み込み**:

   - URL 入力欄に記事の URL を入力 (例: `https://example.com/article`)
   - 「読込」ボタンをクリック
   - 記事タイトルと本文が表示されることを確認

2. **再生機能**:

   - 「再生」ボタンをクリック
   - 最初の段落から音声が再生されることを確認
   - 再生中の段落が黄色くハイライトされることを確認

3. **一時停止/停止**:

   - 再生中に「一時停止」ボタンをクリック → 音声が止まることを確認
   - 「停止」ボタンをクリック → 再生位置がリセットされることを確認

4. **連続再生**:

   - 「再生」ボタンをクリック
   - 1 つの段落の再生が終わったら、自動的に次の段落が再生されることを確認
   - すべての段落が順番に再生されることを確認

5. **自動スクロール**:

   - 「再生」ボタンをクリック
   - 再生中の段落が常に画面の中央付近に表示されるよう、自動的にスクロールすることを確認

6. **クリック再生 (Seek 機能)**:

   - 任意の段落をクリック
   - その段落から再生が開始されることを確認

7. **エラーハンドリング**:
   - 無効な URL を入力して「読込」ボタンをクリック
   - エラーメッセージが表示されることを確認
   - api-server が停止している状態でテスト
   - 適切なエラーメッセージが表示されることを確認

### 推奨テスト URL

- 日本語記事: Qiita、Zenn、note などの技術記事
- ニュースサイトの記事
- ブログ記事

### テスト時の注意点

- **api-server が起動していること**を確認してください
- 初回の音声合成には数秒かかる場合があります
- ネットワーク接続が必要です

## プロジェクト構造

```
packages/web-app/
├── app/
│   ├── layout.tsx          # ルートレイアウト (メタデータ、フォント設定)
│   ├── page.tsx            # メインページ (URL入力、再生制御)
│   └── globals.css         # グローバルスタイル
├── components/
│   └── ReaderView.tsx      # リーダービューコンポーネント
├── hooks/
│   └── usePlayback.ts      # 再生制御カスタムフック
├── lib/
│   └── api.ts              # APIクライアント
├── types/
│   └── api.ts              # 型定義
├── public/                 # 静的ファイル
├── .env.local              # 環境変数 (API URL)
├── package.json            # 依存関係
├── tsconfig.json           # TypeScript設定
├── tailwind.config.ts      # Tailwind CSS設定
└── README.md               # プロジェクトドキュメント
```

## 技術的なハイライト

### 1. クライアントサイド・オーケストレーション

- フロントエンドで再生キューを完全に管理
- バックエンドへのリクエストを最小限に

### 2. 自動スクロール実装

```typescript
// 再生中のチャンクが変わるたびに自動スクロール
useEffect(() => {
  if (currentChunkId && activeChunkRef.current) {
    const scrollTop = /* 中央配置の計算 */;
    container.scrollTo({ top: scrollTop, behavior: "smooth" });
  }
}, [currentChunkId]);
```

### 3. 連続再生の仕組み

```typescript
audio.onended = () => {
  // 次のチャンクがあれば自動的に再生
  if (index + 1 < chunks.length) {
    playFromIndex(index + 1);
  }
};
```

### 4. Seek 機能

```typescript
const seekToChunk = (chunkId: string) => {
  const index = chunks.findIndex((chunk) => chunk.id === chunkId);
  if (index >= 0) {
    playFromIndex(index);
  }
};
```

## 今後の拡張案

1. **プレイリスト機能**: 複数の記事を連続で再生
2. **再生速度調整**: 0.5x 〜 2.0x の速度変更
3. **音声キャッシュ**: 一度合成した音声をローカルストレージに保存
4. **ブックマーク**: 読みかけの記事を保存
5. **プログレスバー**: 全体の再生進捗を視覚化
6. **キーボードショートカット**: スペースキーで再生/一時停止など

## まとめ

要求されたすべての機能を、5 つの段階的なコミットに分けて実装しました。音楽アプリの歌詞表示のような滑らかな体験を提供する Web アプリケーションが完成しました。

クライアントサイド・オーケストレーションにより、フロントエンド側で柔軟な再生制御を実現し、自動スクロールとハイライト表示により、直感的で快適なユーザー体験を提供します。
